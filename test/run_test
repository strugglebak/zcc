#!/bin/sh

if [ ! -f ../parser ]
  then echo "Need to build parser first"; exit 1;
fi

for i in input*
  do if [ ! -f "assert/out.$i" ]
      then echo "Can't run test on $i, no input file"
      else
        echo -n "test $i..."
        ../parser $i
        cc -o out out.s ../lib/print_int.c ../lib/print_char.c
        ./out > assert/trial.$i
        cmp -s "assert/out.$i" "assert/trial.$i"
        if [ "$?" -eq "1" ]
        then echo ": Failed"
          diff -c "assert/out.$i" "assert/trial.$i"
          echo
        else echo ": Ok"
        fi
        rm -rf out out.s "assert/trial.$i"
      fi
  done
